{"ast":null,"code":"import { ethers } from 'ethers';\nimport { Contract } from 'web3-eth-contract';\nimport ERC20Abi from './lib/abi/erc20.json';\nimport BigNumber from 'bignumber.js';\nBigNumber.config({\n  EXPONENTIAL_AT: 1000,\n  DECIMAL_PLACES: 80\n});\nconst GAS_LIMIT = {\n  STAKING: {\n    DEFAULT: 200000,\n    SNX: 850000\n  }\n};\nexport const getFarmAddress = farm => {\n  return farm && farm.farmAddress;\n};\nexport const getERC20Address = farm => {\n  return farm && farm.erc20Address;\n};\nexport const getWethContract = farm => {\n  return farm && farm.contracts && farm.contracts.weth;\n};\nexport const getFarmContract = farm => {\n  return farm && farm.contracts && farm.contracts.farm;\n};\nexport const getERC20Contract = farm => {\n  return farm && farm.contracts && farm.contracts.erc20;\n};\nexport const getFarms = farm => {\n  return farm ? farm.contracts.pools.map(_ref => {\n    let {\n      id,\n      pid,\n      version,\n      name,\n      symbol,\n      icon,\n      tokenAddress,\n      tokenSymbol,\n      tokenContract,\n      lpAddress,\n      lpContract,\n      pool\n    } = _ref;\n    return {\n      id,\n      pid,\n      version,\n      name,\n      lpToken: symbol,\n      lpTokenAddress: lpAddress,\n      lpContract,\n      tokenAddress,\n      tokenSymbol,\n      tokenContract,\n      earnToken: 'lto',\n      earnTokenAddress: farm.contracts.erc20.options.address,\n      icon,\n      pool\n    };\n  }) : [];\n};\nexport const getPoolWeight = async (farmContract, pid) => {\n  try {\n    const {\n      allocPoint\n    } = await farmContract.methods.poolInfo(pid).call();\n    const totalAllocPoint = await farmContract.methods.totalAllocPoint().call();\n    return new BigNumber(allocPoint).div(new BigNumber(totalAllocPoint));\n  } catch {\n    return new BigNumber(0);\n  }\n};\nexport const getEarned = async (farmContract, pid, account) => {\n  return farmContract.methods.pending(pid, account).call();\n};\nexport const getTotalLPWethValue = async (farmContract, wethContract, lpContract, tokenContract, pid) => {\n  // Get balance of the token address\n  const tokenAmountWholeLP = await tokenContract.methods.balanceOf(lpContract.options.address).call();\n  const tokenDecimals = await tokenContract.methods.decimals().call(); // Get the share of lpContract that farmContract owns\n\n  const balance = await lpContract.methods.balanceOf(farmContract.options.address).call(); // Convert that into the portion of total lpContract = p1\n\n  const totalSupply = await lpContract.methods.totalSupply().call(); // Get total weth value for the lpContract = w1\n\n  const lpContractWeth = await wethContract.methods.balanceOf(lpContract.options.address).call(); // Return p1 * w1 * 2\n\n  const portionLp = new BigNumber(balance).div(new BigNumber(totalSupply));\n  const lpWethWorth = new BigNumber(lpContractWeth);\n  const totalLpWethValue = portionLp.times(lpWethWorth).times(new BigNumber(2)); // Calculate\n\n  const tokenAmount = new BigNumber(tokenAmountWholeLP).times(portionLp).div(new BigNumber(10).pow(tokenDecimals));\n  const wethAmount = new BigNumber(lpContractWeth).times(portionLp).div(new BigNumber(10).pow(18));\n  return {\n    tokenAmount,\n    wethAmount,\n    totalWethValue: totalLpWethValue.div(new BigNumber(10).pow(18)),\n    tokenPriceInWeth: wethAmount.div(tokenAmount),\n    poolWeight: await getPoolWeight(farmContract, pid)\n  };\n};\nexport const approve = async (lpContract, farmContract, account) => {\n  return lpContract.methods.approve(farmContract.options.address, ethers.constants.MaxUint256).send({\n    from: account\n  });\n};\nexport const getFarmSupply = async farm => {\n  return new BigNumber(await farm.contracts.erc20.methods.totalSupply().call());\n}; //\n\nexport const getPoolStartTime = async farmContract => {\n  return await farmContract.methods.starttime().call();\n};\nexport const stake = async (farmContract, pid, amount, account) => {\n  return farmContract.methods.deposit(pid, new BigNumber(amount).times(new BigNumber(10).pow(18)).toString()).send({\n    from: account\n  }).on('transactionHash', tx => {\n    console.log(tx);\n    return tx.transactionHash;\n  });\n};\nexport const unstake = async (farmContract, pid, amount, account) => {\n  return farmContract.methods.withdraw(pid, new BigNumber(amount).times(new BigNumber(10).pow(18)).toString()).send({\n    from: account\n  }).on('transactionHash', tx => {\n    console.log(tx);\n    return tx.transactionHash;\n  });\n};\nexport const harvest = async (farmContract, pid, account) => {\n  return farmContract.methods.deposit(pid, '0').send({\n    from: account\n  }).on('transactionHash', tx => {\n    console.log(tx);\n    return tx.transactionHash;\n  });\n};\nexport const getStaked = async (farmContract, pid, account) => {\n  try {\n    const {\n      amount\n    } = await farmContract.methods.userInfo(pid, account).call();\n    return new BigNumber(amount);\n  } catch {\n    return new BigNumber(0);\n  }\n};\nexport const redeem = async (farmContract, account) => {\n  let now = new Date().getTime() / 1000;\n\n  if (now >= 1597172400) {\n    return farmContract.methods.exit().send({\n      from: account\n    }).on('transactionHash', tx => {\n      console.log(tx);\n      return tx.transactionHash;\n    });\n  } else {\n    alert('pool not active');\n  }\n};\nexport const getPoolContracts = async yam => {\n  const pools = Object.keys(yam.contracts).filter(c => c.indexOf('_pool') !== -1).reduce((acc, cur) => {\n    const newAcc = { ...acc\n    };\n    newAcc[cur] = yam.contracts[cur];\n    return newAcc;\n  }, {});\n  return pools;\n}; // export const getStaked = async (yam, pool, account) => {\n//   return yam.toBigN(await pool.methods.balanceOf(account).call())\n// }\n\nexport const getCurrentPrice = async yam => {\n  // FORBROCK: get current YAM price\n  return yam.toBigN(await yam.contracts.rebaser.methods.getCurrentTWAP().call());\n};\nexport const getTargetPrice = async yam => {\n  return yam.toBigN(1).toFixed(2);\n};\nexport const getCirculatingSupply = async yam => {\n  let now = await yam.web3.eth.getBlock('latest');\n  let scalingFactor = yam.toBigN(await yam.contracts.yam.methods.yamsScalingFactor().call());\n  let starttime = yam.toBigN(await yam.contracts.eth_pool.methods.starttime().call()).toNumber();\n  let timePassed = now['timestamp'] - starttime;\n\n  if (timePassed < 0) {\n    return 0;\n  }\n\n  let yamsDistributed = yam.toBigN(8 * timePassed * 250000 / 625000); //yams from first 8 pools\n\n  let starttimePool2 = yam.toBigN(await yam.contracts.ycrv_pool.methods.starttime().call()).toNumber();\n  timePassed = now['timestamp'] - starttime;\n  let pool2Yams = yam.toBigN(timePassed * 1500000 / 625000); // yams from second pool. note: just accounts for first week\n\n  let circulating = pool2Yams.plus(yamsDistributed).times(scalingFactor).div(10 ** 36).toFixed(2);\n  return circulating;\n};\nexport const getNextRebaseTimestamp = async yam => {\n  try {\n    let now = await yam.web3.eth.getBlock('latest').then(res => res.timestamp);\n    let interval = 43200; // 12 hours\n\n    let offset = 28800; // 8am/8pm utc\n\n    let secondsToRebase = 0;\n\n    if (await yam.contracts.rebaser.methods.rebasingActive().call()) {\n      if (now % interval > offset) {\n        secondsToRebase = interval - now % interval + offset;\n      } else {\n        secondsToRebase = offset - now % interval;\n      }\n    } else {\n      let twap_init = yam.toBigN(await yam.contracts.rebaser.methods.timeOfTWAPInit().call()).toNumber();\n\n      if (twap_init > 0) {\n        let delay = yam.toBigN(await yam.contracts.rebaser.methods.rebaseDelay().call()).toNumber();\n        let endTime = twap_init + delay;\n\n        if (endTime % interval > offset) {\n          secondsToRebase = interval - endTime % interval + offset;\n        } else {\n          secondsToRebase = offset - endTime % interval;\n        }\n\n        return endTime + secondsToRebase;\n      } else {\n        return now + 13 * 60 * 60; // just know that its greater than 12 hours away\n      }\n    }\n\n    return secondsToRebase;\n  } catch (e) {\n    console.log(e);\n  }\n};\nexport const getTotalSupply = async yam => {\n  return await yam.contracts.yam.methods.totalSupply().call();\n};\nexport const getStats = async yam => {\n  const curPrice = await getCurrentPrice(yam);\n  const circSupply = await getCirculatingSupply(yam);\n  const nextRebase = await getNextRebaseTimestamp(yam);\n  const targetPrice = await getTargetPrice(yam);\n  const totalSupply = await getTotalSupply(yam);\n  return {\n    circSupply,\n    curPrice,\n    nextRebase,\n    targetPrice,\n    totalSupply\n  };\n};\nexport const vote = async (yam, account) => {\n  return yam.contracts.gov.methods.castVote(0, true).send({\n    from: account\n  });\n};\nexport const delegate = async (yam, account) => {\n  return yam.contracts.yam.methods.delegate('0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84').send({\n    from: account\n  });\n};\nexport const didDelegate = async (yam, account) => {\n  return (await yam.contracts.yam.methods.delegates(account).call()) === '0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84';\n};\nexport const getVotes = async yam => {\n  const votesRaw = new BigNumber(await yam.contracts.yam.methods.getCurrentVotes('0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84').call()).div(10 ** 24);\n  return votesRaw;\n};\nexport const getScalingFactor = async yam => {\n  return new BigNumber(await yam.contracts.yam.methods.yamsScalingFactor().call());\n};\nexport const getDelegatedBalance = async (yam, account) => {\n  return new BigNumber(await yam.contracts.yam.methods.balanceOfUnderlying(account).call()).div(10 ** 24);\n};\nexport const migrate = async (yam, account) => {\n  return yam.contracts.yamV2migration.methods.migrate().send({\n    from: account\n  });\n};\nexport const getMigrationEndTime = async yam => {\n  return yam.toBigN(await yam.contracts.yamV2migration.methods.startTime().call()).plus(yam.toBigN(86400 * 3)).toNumber();\n};","map":{"version":3,"sources":["/home/fibo/Documents/workspace/front-lp-stack/src/farm/utils.js"],"names":["ethers","Contract","ERC20Abi","BigNumber","config","EXPONENTIAL_AT","DECIMAL_PLACES","GAS_LIMIT","STAKING","DEFAULT","SNX","getFarmAddress","farm","farmAddress","getERC20Address","erc20Address","getWethContract","contracts","weth","getFarmContract","getERC20Contract","erc20","getFarms","pools","map","id","pid","version","name","symbol","icon","tokenAddress","tokenSymbol","tokenContract","lpAddress","lpContract","pool","lpToken","lpTokenAddress","earnToken","earnTokenAddress","options","address","getPoolWeight","farmContract","allocPoint","methods","poolInfo","call","totalAllocPoint","div","getEarned","account","pending","getTotalLPWethValue","wethContract","tokenAmountWholeLP","balanceOf","tokenDecimals","decimals","balance","totalSupply","lpContractWeth","portionLp","lpWethWorth","totalLpWethValue","times","tokenAmount","pow","wethAmount","totalWethValue","tokenPriceInWeth","poolWeight","approve","constants","MaxUint256","send","from","getFarmSupply","getPoolStartTime","starttime","stake","amount","deposit","toString","on","tx","console","log","transactionHash","unstake","withdraw","harvest","getStaked","userInfo","redeem","now","Date","getTime","exit","alert","getPoolContracts","yam","Object","keys","filter","c","indexOf","reduce","acc","cur","newAcc","getCurrentPrice","toBigN","rebaser","getCurrentTWAP","getTargetPrice","toFixed","getCirculatingSupply","web3","eth","getBlock","scalingFactor","yamsScalingFactor","eth_pool","toNumber","timePassed","yamsDistributed","starttimePool2","ycrv_pool","pool2Yams","circulating","plus","getNextRebaseTimestamp","then","res","timestamp","interval","offset","secondsToRebase","rebasingActive","twap_init","timeOfTWAPInit","delay","rebaseDelay","endTime","e","getTotalSupply","getStats","curPrice","circSupply","nextRebase","targetPrice","vote","gov","castVote","delegate","didDelegate","delegates","getVotes","votesRaw","getCurrentVotes","getScalingFactor","getDelegatedBalance","balanceOfUnderlying","migrate","yamV2migration","getMigrationEndTime","startTime"],"mappings":"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","sourcesContent":["import { ethers } from 'ethers'\nimport { Contract } from 'web3-eth-contract'\nimport ERC20Abi from './lib/abi/erc20.json'\n\nimport BigNumber from 'bignumber.js'\n\nBigNumber.config({\n  EXPONENTIAL_AT: 1000,\n  DECIMAL_PLACES: 80,\n})\n\nconst GAS_LIMIT = {\n  STAKING: {\n    DEFAULT: 200000,\n    SNX: 850000,\n  },\n}\n\nexport const getFarmAddress = (farm) => {\n  return farm && farm.farmAddress\n}\nexport const getERC20Address = (farm) => {\n  return farm && farm.erc20Address\n}\nexport const getWethContract = (farm) => {\n  return farm && farm.contracts && farm.contracts.weth\n}\n\nexport const getFarmContract = (farm) => {\n  return farm && farm.contracts && farm.contracts.farm\n}\nexport const getERC20Contract = (farm) => {\n  return farm && farm.contracts && farm.contracts.erc20\n}\n\nexport const getFarms = (farm) => {\n  return farm\n    ? farm.contracts.pools.map(\n        ({\n          id,\n          pid,\n          version,\n          name,\n          symbol,\n          icon,\n          tokenAddress,\n          tokenSymbol,\n          tokenContract,\n          lpAddress,\n          lpContract,\n          pool,\n        }) => ({\n          id,\n          pid,\n          version,\n          name,\n          lpToken: symbol,\n          lpTokenAddress: lpAddress,\n          lpContract,\n          tokenAddress,\n          tokenSymbol,\n          tokenContract,\n          earnToken: 'lto',\n          earnTokenAddress: farm.contracts.erc20.options.address,\n          icon,\n          pool,\n        }),\n      )\n    : []\n}\n\nexport const getPoolWeight = async (farmContract, pid) => {\n  try {\n    const { allocPoint } = await farmContract.methods.poolInfo(pid).call()\n    const totalAllocPoint = await farmContract.methods.totalAllocPoint().call()\n    return new BigNumber(allocPoint).div(new BigNumber(totalAllocPoint))\n  } catch {\n    return new BigNumber(0)\n  }\n}\n\nexport const getEarned = async (farmContract, pid, account) => {\n  return farmContract.methods.pending(pid, account).call()\n}\n\nexport const getTotalLPWethValue = async (\n  farmContract,\n  wethContract,\n  lpContract,\n  tokenContract,\n  pid,\n) => {\n  // Get balance of the token address\n  const tokenAmountWholeLP = await tokenContract.methods\n    .balanceOf(lpContract.options.address)\n    .call()\n  const tokenDecimals = await tokenContract.methods.decimals().call()\n  // Get the share of lpContract that farmContract owns\n  const balance = await lpContract.methods\n    .balanceOf(farmContract.options.address)\n    .call()\n  // Convert that into the portion of total lpContract = p1\n  const totalSupply = await lpContract.methods.totalSupply().call()\n  // Get total weth value for the lpContract = w1\n  const lpContractWeth = await wethContract.methods\n    .balanceOf(lpContract.options.address)\n    .call()\n  // Return p1 * w1 * 2\n  const portionLp = new BigNumber(balance).div(new BigNumber(totalSupply))\n  const lpWethWorth = new BigNumber(lpContractWeth)\n  const totalLpWethValue = portionLp.times(lpWethWorth).times(new BigNumber(2))\n  // Calculate\n  const tokenAmount = new BigNumber(tokenAmountWholeLP)\n    .times(portionLp)\n    .div(new BigNumber(10).pow(tokenDecimals))\n\n  const wethAmount = new BigNumber(lpContractWeth)\n    .times(portionLp)\n    .div(new BigNumber(10).pow(18))\n  return {\n    tokenAmount,\n    wethAmount,\n    totalWethValue: totalLpWethValue.div(new BigNumber(10).pow(18)),\n    tokenPriceInWeth: wethAmount.div(tokenAmount),\n    poolWeight: await getPoolWeight(farmContract, pid),\n  }\n}\n\nexport const approve = async (lpContract, farmContract, account) => {\n  return lpContract.methods\n    .approve(farmContract.options.address, ethers.constants.MaxUint256)\n    .send({ from: account })\n}\n\nexport const getFarmSupply = async (farm) => {\n  return new BigNumber(await farm.contracts.erc20.methods.totalSupply().call())\n}\n\n//\n\nexport const getPoolStartTime = async (farmContract) => {\n  return await farmContract.methods.starttime().call()\n}\n\nexport const stake = async (farmContract, pid, amount, account) => {\n  return farmContract.methods\n    .deposit(\n      pid,\n      new BigNumber(amount).times(new BigNumber(10).pow(18)).toString(),\n    )\n    .send({ from: account })\n    .on('transactionHash', (tx) => {\n      console.log(tx)\n      return tx.transactionHash\n    })\n}\n\nexport const unstake = async (farmContract, pid, amount, account) => {\n  return farmContract.methods\n    .withdraw(\n      pid,\n      new BigNumber(amount).times(new BigNumber(10).pow(18)).toString(),\n    )\n    .send({ from: account })\n    .on('transactionHash', (tx) => {\n      console.log(tx)\n      return tx.transactionHash\n    })\n}\nexport const harvest = async (farmContract, pid, account) => {\n  return farmContract.methods\n    .deposit(pid, '0')\n    .send({ from: account })\n    .on('transactionHash', (tx) => {\n      console.log(tx)\n      return tx.transactionHash\n    })\n}\n\nexport const getStaked = async (farmContract, pid, account) => {\n  try {\n    const { amount } = await farmContract.methods.userInfo(pid, account).call()\n    return new BigNumber(amount)\n  } catch {\n    return new BigNumber(0)\n  }\n}\n\nexport const redeem = async (farmContract, account) => {\n  let now = new Date().getTime() / 1000\n  if (now >= 1597172400) {\n    return farmContract.methods\n      .exit()\n      .send({ from: account })\n      .on('transactionHash', (tx) => {\n        console.log(tx)\n        return tx.transactionHash\n      })\n  } else {\n    alert('pool not active')\n  }\n}\n\nexport const getPoolContracts = async (yam) => {\n  const pools = Object.keys(yam.contracts)\n    .filter((c) => c.indexOf('_pool') !== -1)\n    .reduce((acc, cur) => {\n      const newAcc = { ...acc }\n      newAcc[cur] = yam.contracts[cur]\n      return newAcc\n    }, {})\n  return pools\n}\n\n// export const getStaked = async (yam, pool, account) => {\n//   return yam.toBigN(await pool.methods.balanceOf(account).call())\n// }\n\nexport const getCurrentPrice = async (yam) => {\n  // FORBROCK: get current YAM price\n  return yam.toBigN(await yam.contracts.rebaser.methods.getCurrentTWAP().call())\n}\n\nexport const getTargetPrice = async (yam) => {\n  return yam.toBigN(1).toFixed(2)\n}\n\nexport const getCirculatingSupply = async (yam) => {\n  let now = await yam.web3.eth.getBlock('latest')\n  let scalingFactor = yam.toBigN(\n    await yam.contracts.yam.methods.yamsScalingFactor().call(),\n  )\n  let starttime = yam\n    .toBigN(await yam.contracts.eth_pool.methods.starttime().call())\n    .toNumber()\n  let timePassed = now['timestamp'] - starttime\n  if (timePassed < 0) {\n    return 0\n  }\n  let yamsDistributed = yam.toBigN((8 * timePassed * 250000) / 625000) //yams from first 8 pools\n  let starttimePool2 = yam\n    .toBigN(await yam.contracts.ycrv_pool.methods.starttime().call())\n    .toNumber()\n  timePassed = now['timestamp'] - starttime\n  let pool2Yams = yam.toBigN((timePassed * 1500000) / 625000) // yams from second pool. note: just accounts for first week\n  let circulating = pool2Yams\n    .plus(yamsDistributed)\n    .times(scalingFactor)\n    .div(10 ** 36)\n    .toFixed(2)\n  return circulating\n}\n\nexport const getNextRebaseTimestamp = async (yam) => {\n  try {\n    let now = await yam.web3.eth.getBlock('latest').then((res) => res.timestamp)\n    let interval = 43200 // 12 hours\n    let offset = 28800 // 8am/8pm utc\n    let secondsToRebase = 0\n    if (await yam.contracts.rebaser.methods.rebasingActive().call()) {\n      if (now % interval > offset) {\n        secondsToRebase = interval - (now % interval) + offset\n      } else {\n        secondsToRebase = offset - (now % interval)\n      }\n    } else {\n      let twap_init = yam\n        .toBigN(await yam.contracts.rebaser.methods.timeOfTWAPInit().call())\n        .toNumber()\n      if (twap_init > 0) {\n        let delay = yam\n          .toBigN(await yam.contracts.rebaser.methods.rebaseDelay().call())\n          .toNumber()\n        let endTime = twap_init + delay\n        if (endTime % interval > offset) {\n          secondsToRebase = interval - (endTime % interval) + offset\n        } else {\n          secondsToRebase = offset - (endTime % interval)\n        }\n        return endTime + secondsToRebase\n      } else {\n        return now + 13 * 60 * 60 // just know that its greater than 12 hours away\n      }\n    }\n    return secondsToRebase\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nexport const getTotalSupply = async (yam) => {\n  return await yam.contracts.yam.methods.totalSupply().call()\n}\n\nexport const getStats = async (yam) => {\n  const curPrice = await getCurrentPrice(yam)\n  const circSupply = await getCirculatingSupply(yam)\n  const nextRebase = await getNextRebaseTimestamp(yam)\n  const targetPrice = await getTargetPrice(yam)\n  const totalSupply = await getTotalSupply(yam)\n  return {\n    circSupply,\n    curPrice,\n    nextRebase,\n    targetPrice,\n    totalSupply,\n  }\n}\n\nexport const vote = async (yam, account) => {\n  return yam.contracts.gov.methods.castVote(0, true).send({ from: account })\n}\n\nexport const delegate = async (yam, account) => {\n  return yam.contracts.yam.methods\n    .delegate('0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84')\n    .send({ from: account })\n}\n\nexport const didDelegate = async (yam, account) => {\n  return (\n    (await yam.contracts.yam.methods.delegates(account).call()) ===\n    '0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84'\n  )\n}\n\nexport const getVotes = async (yam) => {\n  const votesRaw = new BigNumber(\n    await yam.contracts.yam.methods\n      .getCurrentVotes('0x683A78bA1f6b25E29fbBC9Cd1BFA29A51520De84')\n      .call(),\n  ).div(10 ** 24)\n  return votesRaw\n}\n\nexport const getScalingFactor = async (yam) => {\n  return new BigNumber(\n    await yam.contracts.yam.methods.yamsScalingFactor().call(),\n  )\n}\n\nexport const getDelegatedBalance = async (yam, account) => {\n  return new BigNumber(\n    await yam.contracts.yam.methods.balanceOfUnderlying(account).call(),\n  ).div(10 ** 24)\n}\n\nexport const migrate = async (yam, account) => {\n  return yam.contracts.yamV2migration.methods.migrate().send({ from: account })\n}\n\nexport const getMigrationEndTime = async (yam) => {\n  return yam\n    .toBigN(await yam.contracts.yamV2migration.methods.startTime().call())\n    .plus(yam.toBigN(86400 * 3))\n    .toNumber()\n}\n"]},"metadata":{},"sourceType":"module"}